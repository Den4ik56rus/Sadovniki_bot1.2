# –ü–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä Telegram-–±–æ—Ç–∞ –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ —è–≥–æ–¥–Ω—ã–º –∫—É–ª—å—Ç—É—Ä–∞–º

**–î–∞—Ç–∞:** 2025-12-03
**–ü—Ä–æ–µ–∫—Ç:** Sadovniki-bot v1.2
**–°—Ç–∞—Ç—É—Å:** Production-ready

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#–∫—Ä–∞—Ç–∫–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–°–∏—Å—Ç–µ–º–∞ RAG (Retrieval-Augmented Generation)](#—Å–∏—Å—Ç–µ–º–∞-rag-retrieval-augmented-generation)
6. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
7. [–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏](#—Å–∏—Å—Ç–µ–º–∞-–ø—Ä–æ–º–ø—Ç–æ–≤-–∏-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏)
8. [–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å](#–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è-–ø–∞–Ω–µ–ª—å)
9. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-openai)
10. [–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏](#—Å–∏—Å—Ç–µ–º–∞-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è-–∏-–æ—Ç–ª–∞–¥–∫–∏)
11. [Deployment –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#deployment-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
12. [–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π](#—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π)

---

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Sadovniki-bot** ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å–∞–¥–æ–≤–æ–¥–æ–≤ –ø–æ —è–≥–æ–¥–Ω—ã–º –∫—É–ª—å—Ç—É—Ä–∞–º. –ë–æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞:

- –ö–ª—É–±–Ω–∏–∫–µ (–ª–µ—Ç–Ω—è—è, —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è)
- –ú–∞–ª–∏–Ω–µ (–ª–µ—Ç–Ω—è—è, —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è)
- –°–º–æ—Ä–æ–¥–∏–Ω–µ
- –ì–æ–ª—É–±–∏–∫–µ
- –ñ–∏–º–æ–ª–æ—Å—Ç–∏
- –ö—Ä—ã–∂–æ–≤–Ω–∏–∫–µ
- –ï–∂–µ–≤–∏–∫–µ

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- RAG-—Å–∏—Å—Ç–µ–º–∞ —Å —Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–º –ø–æ–∏—Å–∫–æ–º (Q&A, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –æ–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä –∏ —Ç–∏–ø–æ–≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- LLM-powered –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GPT-4
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π
- –î–≤—É—Ö—Ä–µ–∂–∏–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Telegram Bot API                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Aiogram Framework (v3.x)                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ    Handlers Layer (Router-based)             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Menu handlers                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Consultation handlers (by category)       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Admin handlers                            ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Services Layer (Business Logic)             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  LLM Services                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - consultation_llm (orchestrator)           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - classification_llm (culture detection)    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - embeddings_llm (vector generation)        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - core_llm (OpenAI client)                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  RAG Services                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - unified_retriever (3-tier search)         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - kb_retriever (Q&A search)                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Document Services                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - processor (file processing)               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - chunker (text splitting)                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Data Layer (Repositories)                   ‚îÇ
‚îÇ  - users_repo                                       ‚îÇ
‚îÇ  - topics_repo                                      ‚îÇ
‚îÇ  - messages_repo                                    ‚îÇ
‚îÇ  - kb_repo (knowledge_base)                         ‚îÇ
‚îÇ  - document_chunks_repo                             ‚îÇ
‚îÇ  - moderation_repo                                  ‚îÇ
‚îÇ  - terminology_repo                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      PostgreSQL + pgvector                          ‚îÇ
‚îÇ  - –†–µ–ª–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ                               ‚îÇ
‚îÇ  - –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (HNSW)                         ‚îÇ
‚îÇ  - 1536-–º–µ—Ä–Ω—ã–µ embeddings                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞

**–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

1. **Handlers** (`src/handlers/`) ‚Äî —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Telegram, –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
2. **Services** (`src/services/`) ‚Äî –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞ —Å –ë–î, LLM-–≤—ã–∑–æ–≤—ã
3. **Keyboards** (`src/keyboards/`) ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (Reply/Inline), –±–µ–∑ –ª–æ–≥–∏–∫–∏
4. **Models** (`src/models/`) ‚Äî Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
5. **Prompts** (`src/prompts/`) ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏ –ø—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥
6. **Utils** (`src/utils/`) ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞, JSON)

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **Python 3.11+**
- **Aiogram 3.x** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API
- **asyncpg** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **pydantic / pydantic-settings** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### AI/ML
- **OpenAI API** (GPT-4.1-mini) ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- **text-embedding-3-small** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (1536 –∏–∑–º–µ—Ä–µ–Ω–∏–π)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL 16** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º **pgvector**
- **HNSW –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –≤–µ–∫—Ç–æ—Ä–∞–º (m=16, ef_construction=64)

### Infrastructure
- **Docker / Docker Compose** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è PostgreSQL
- **Environment Variables** (.env) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### Dependency Management
- **requirements.txt** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### 1. `users`
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –±–æ—Ç–∞.

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    telegram_user_id BIGINT UNIQUE NOT NULL,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 2. `topics`
–•—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ (—Ç–µ–º—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π).

```sql
CREATE TABLE topics (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    session_id TEXT NOT NULL,
    is_open BOOLEAN DEFAULT TRUE,
    meta JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    closed_at TIMESTAMP
);
```

#### 3. `messages`
–õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üî –±–æ—Ç).

```sql
CREATE TABLE messages (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    topic_id INTEGER REFERENCES topics(id),
    direction TEXT NOT NULL, -- 'user' / 'bot'
    text TEXT NOT NULL,
    session_id TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4. `knowledge_base`
–•—Ä–∞–Ω–∏—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ Q&A –ø–∞—Ä—ã —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏ (–£–†–û–í–ï–ù–¨ 1 RAG).

```sql
CREATE TABLE knowledge_base (
    id SERIAL PRIMARY KEY,
    category TEXT NOT NULL,       -- –¢–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (–ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π, –∑–∞—â–∏—Ç–∞ –∏ —Ç.–ø.)
    subcategory TEXT,              -- –ö—É–ª—å—Ç—É—Ä–∞ (–º–∞–ª–∏–Ω–∞, –∫–ª—É–±–Ω–∏–∫–∞ –∏ —Ç.–ø.)
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    embedding VECTOR(1536) NOT NULL,
    source_type TEXT DEFAULT 'admin_qa',
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `vector_cosine_ops` (HNSW) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Å—Ö–æ–∂–µ—Å—Ç–∏

#### 5. `documents`
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

```sql
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    filename TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_hash TEXT UNIQUE NOT NULL,
    category TEXT NOT NULL,
    subcategory TEXT,
    processing_status TEXT DEFAULT 'pending',
    total_chunks INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 6. `document_chunks`
–§—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏ (–£–†–û–í–ï–ù–¨ 2 –∏ 3 RAG).

```sql
CREATE TABLE document_chunks (
    id SERIAL PRIMARY KEY,
    document_id INTEGER NOT NULL REFERENCES documents(id) ON DELETE CASCADE,
    chunk_index INTEGER NOT NULL,
    chunk_text TEXT NOT NULL,
    page_number INTEGER,
    embedding VECTOR(1536) NOT NULL,
    category TEXT NOT NULL,
    subcategory TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `vector_cosine_ops` (HNSW) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

#### 7. `moderation_queue`
–û—á–µ—Ä–µ–¥—å Q&A –ø–∞—Ä –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π.

```sql
CREATE TABLE moderation_queue (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    topic_id INTEGER REFERENCES topics(id),
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    category_guess TEXT,
    status TEXT DEFAULT 'pending', -- 'pending', 'approved', 'rejected'
    admin_id BIGINT,
    kb_id INTEGER REFERENCES knowledge_base(id),
    created_at TIMESTAMP DEFAULT NOW(),
    reviewed_at TIMESTAMP
);
```

#### 8. `terminology`
–°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö LLM.

```sql
CREATE TABLE terminology (
    id SERIAL PRIMARY KEY,
    term TEXT NOT NULL UNIQUE,
    preferred_phrase TEXT NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## –°–∏—Å—Ç–µ–º–∞ RAG (Retrieval-Augmented Generation)

### –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∏—Å–∫–∞

RAG-—Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫** –ø–æ —Ç—Ä—ë–º —É—Ä–æ–≤–Ω—è–º:

#### **–£–†–û–í–ï–ù–¨ 1 (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç): Q&A –ø–∞—Ä—ã**
- –ò—Å—Ç–æ—á–Ω–∏–∫: `knowledge_base` (—Ç–∞–±–ª–∏—Ü–∞)
- –°–æ–¥–µ—Ä–∂–∏—Ç: –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –ø–∞—Ä—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: **–¥–æ—Å–ª–æ–≤–Ω–æ–µ** –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ –ø–æ–¥—Ö–æ–¥–∏—Ç
- Distance threshold: 0.6 (cosine similarity)
- Fallback: –µ—Å–ª–∏ —Å subcategory –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏ ‚Üí –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### **–£–†–û–í–ï–ù–¨ 2 (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç): –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã**
- –ò—Å—Ç–æ—á–Ω–∏–∫: `document_chunks` —Å —Ç–æ—á–Ω–æ–π subcategory
- –°–æ–¥–µ—Ä–∂–∏—Ç: —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –∫—É–ª—å—Ç—É—Ä—ã
  - –ù–∞–ø—Ä–∏–º–µ—Ä: "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è", "–∫–ª—É–±–Ω–∏–∫–∞ –ª–µ—Ç–Ω—è—è"
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- Distance threshold: 0.75

#### **–£–†–û–í–ï–ù–¨ 3 (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç): –û–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã**
- –ò—Å—Ç–æ—á–Ω–∏–∫: `document_chunks` —Å –æ–±—â–µ–π subcategory
- –°–æ–¥–µ—Ä–∂–∏—Ç: —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –æ–±—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –ù–∞–ø—Ä–∏–º–µ—Ä: "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è", "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- Distance threshold: 0.75

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã RAG

```python
async def retrieve_unified_snippets(
    category: str,              # –¢–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
    query_embedding: List[float],
    subcategory: Optional[str] = None,  # –ö—É–ª—å—Ç—É—Ä–∞
    qa_limit: int = 20,         # –£–†–û–í–ï–ù–¨ 1
    level2_limit: int = 20,     # –£–†–û–í–ï–ù–¨ 2
    level3_limit: int = 20,     # –£–†–û–í–ï–ù–¨ 3
) -> List[Dict]:
    # 1. –ü–æ–∏—Å–∫ Q&A –ø–∞—Ä (–£–†–û–í–ï–ù–¨ 1)
    qa_rows = await kb_search(...)
    if not qa_rows and subcategory:
        # Fallback: –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ–∑ subcategory
        qa_rows = await kb_search(category=category, subcategory=None, ...)

    # 2. –ü–æ–∏—Å–∫ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–£–†–û–í–ï–ù–¨ 2)
    level2_rows = await chunks_search(
        category=category,
        subcategory=subcategory,  # –ù–∞–ø—Ä–∏–º–µ—Ä: "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
        ...
    )

    # 3. –ü–æ–∏—Å–∫ –æ–±—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–£–†–û–í–ï–ù–¨ 3)
    general_subcategory = get_general_subcategory(subcategory)
    # "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è" ‚Üí "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"
    if general_subcategory != subcategory:
        level3_rows = await chunks_search(
            category=category,
            subcategory=general_subcategory,
            ...
        )

    # 4. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ priority_level, –∑–∞—Ç–µ–º distance
    all_snippets.sort(key=lambda x: (x["priority_level"], x["distance"]))
    return all_snippets
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RAG –≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

RAG-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç LLM —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

```
üìå –ü–†–ò–û–†–ò–¢–ï–¢ 1 - –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ Q&A –æ—Ç–≤–µ—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–π –¥–æ—Å–ª–æ–≤–Ω–æ –µ—Å–ª–∏ –¥–∞–Ω –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç):
  1) [—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞]
  2) [—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞]

üìò –ü–†–ò–û–†–ò–¢–ï–¢ 2 - –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∫—É–ª—å—Ç—É—Ä—ã:
  1) [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞]
  2) [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞]

üìó –ü–†–ò–û–†–ò–¢–ï–¢ 3 - –û–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –∫—É–ª—å—Ç—É—Ä–µ:
  1) [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞]
  2) [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞]

–ü–†–ê–í–ò–õ–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:
1. –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 > –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 > –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3
2. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç ‚Äî –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 1. –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ 6 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **–ü–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π** ‚Äî –ø–æ–¥–∫–æ—Ä–º–∫–∏, —É–¥–æ–±—Ä–µ–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –≤–Ω–µ—Å–µ–Ω–∏—è
- **–ü–æ—Å–∞–¥–∫–∞ –∏ —É—Ö–æ–¥** ‚Äî —Å—Ä–æ–∫–∏ –ø–æ—Å–∞–¥–∫–∏, —É—Ö–æ–¥, –æ–±—Ä–µ–∑–∫–∞
- **–ó–∞—â–∏—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π** ‚Äî –±–æ–ª–µ–∑–Ω–∏, –≤—Ä–µ–¥–∏—Ç–µ–ª–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ—á–≤—ã** ‚Äî pH, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –æ—Ä–≥–∞–Ω–∏–∫–∞
- **–ü–æ–¥–±–æ—Ä —Å–æ—Ä—Ç–∞/–º–µ—Å—Ç–∞** ‚Äî –≤—ã–±–æ—Ä –∫—É–ª—å—Ç—É—Ä –ø–æ–¥ –∫–ª–∏–º–∞—Ç –∏ —É—Å–ª–æ–≤–∏—è
- **–î—Ä—É–≥–∞—è —Ç–µ–º–∞** ‚Äî –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —è–≥–æ–¥–Ω—ã–º –∫—É–ª—å—Ç—É—Ä–∞–º

#### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä

LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫—É–ª—å—Ç—É—Ä—É –∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ö–ª—É–±–Ω–∏–∫–∞ (–æ–±—â–∞—è / –ª–µ—Ç–Ω—è—è / —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è)
- –ú–∞–ª–∏–Ω–∞ (–æ–±—â–∞—è / –ª–µ—Ç–Ω—è—è / —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è)
- –°–º–æ—Ä–æ–¥–∏–Ω–∞
- –ì–æ–ª—É–±–∏–∫–∞
- –ñ–∏–º–æ–ª–æ—Å—Ç—å
- –ö—Ä—ã–∂–æ–≤–Ω–∏–∫
- –ï–∂–µ–≤–∏–∫–∞

#### 3. –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (–¥–ª—è –ø–∏—Ç–∞–Ω–∏—è —Ä–∞—Å—Ç–µ–Ω–∏–π)

**–≠—Ç–∞–ø 1:** –ï—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –æ–±—â–∞—è –∫—É–ª—å—Ç—É—Ä–∞ (–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è / –º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è):
- –ë–æ—Ç –∑–∞–¥–∞—ë—Ç —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫–∞—è —É –≤–∞—Å –º–∞–ª–∏–Ω–∞: –ª–µ—Ç–Ω—è—è –∏–ª–∏ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è?"

**–≠—Ç–∞–ø 2:** –ü–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ç–∏–ø–∞:
- LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —É—á—ë—Ç–æ–º —Ç–∏–ø–∞ –∫—É–ª—å—Ç—É—Ä—ã

**–≠—Ç–∞–ø 3:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞:
- üîÑ –ó–∞–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —Ç–µ–ø–ª–∏—Ü–∞/–≥—Ä—É–Ω—Ç)
- üìã –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ–¥–∫–æ—Ä–º–æ–∫
- ‚ùì –í–æ–ø—Ä–æ—Å –ø–æ –Ω–æ–≤–æ–π —Ç–µ–º–µ

#### 4. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** —Å—Ä–µ–¥–Ω—è—è –ø–æ–ª–æ—Å–∞, –£—Ä–∞–ª, –°–∏–±–∏—Ä—å, —é–≥, —Å–µ–≤–µ—Ä, –î–∞–ª—å–Ω–∏–π –í–æ—Å—Ç–æ–∫
- **–¢–∏–ø –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è:** –æ—Ç–∫—Ä—ã—Ç—ã–π –≥—Ä—É–Ω—Ç, —Ç–µ–ø–ª–∏—Ü–∞, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

#### 5. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞

–ë–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–µ—Å–µ–¥—ã.

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

#### 1. –î–≤—É—Ö—Ä–µ–∂–∏–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
- –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

#### 2. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

**–û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏:**
- –í—Å–µ Q&A –ø–∞—Ä—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å `moderation_queue`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤, –¥–∞—Ç–∞ —Å–∞–º–æ–≥–æ —Å—Ç–∞—Ä–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:**
```
–ö–∞–Ω–¥–∏–¥–∞—Ç #123

–ö–∞—Ç–µ–≥–æ—Ä–∏—è (—Ç–∏–ø / –∫—É–ª—å—Ç—É—Ä–∞): –ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π / –º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è

–ü–æ–ª–Ω—ã–π –≤–æ–ø—Ä–æ—Å (root + —É—Ç–æ—á–Ω–µ–Ω–∏—è):
[—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞]

–û—Ç–≤–µ—Ç –±–æ—Ç–∞:
[—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞]

[‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ KB] [‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç] [üè∑ –ö–∞—Ç–µ–≥–æ—Ä–∏—è] [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å]
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –≤ KB** ‚Äî –æ–¥–æ–±—Ä–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
- ‚úèÔ∏è **–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç** ‚Äî –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM (—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏)
- üè∑ **–ö–∞—Ç–µ–≥–æ—Ä–∏—è** ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Ç–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ / –∫—É–ª—å—Ç—É—Ä–∞)
- ‚ùå **–û—Ç–∫–ª–æ–Ω–∏—Ç—å** ‚Äî –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞

#### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

**–†—É—á–Ω–æ–π –≤–≤–æ–¥:**
```
–§–æ—Ä–º–∞—Ç: —Ç–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ / –∫—É–ª—å—Ç—É—Ä–∞
–ü—Ä–∏–º–µ—Ä—ã:
  ‚Ä¢ –º–∞–ª–∏–Ω–∞
  ‚Ä¢ –∫–ª—É–±–Ω–∏–∫–∞ —Å–∞–¥–æ–≤–∞—è
  ‚Ä¢ –ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π / –º–∞–ª–∏–Ω–∞
  ‚Ä¢ –∑–∞—â–∏—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π / –∫–ª—É–±–Ω–∏–∫–∞ —Å–∞–¥–æ–≤–∞—è
```

**–í—ã–±–æ—Ä –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö:**
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø-9 –ø–æ—Ö–æ–∂–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É —Å –≤–æ–ø—Ä–æ—Å–æ–º

**–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:**
- "–º–∞–ª–∏–Ω–∞" ‚Üí "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"
- "–∫–ª—É–±–Ω–∏–∫–∞" ‚Üí "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –≤–∞–ª–∏–¥–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É

#### 4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç"
2. –í–≤–æ–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: "–î–æ–±–∞–≤—å –¥–æ–∑–∏—Ä–æ–≤–∫—É", "–£–±–µ—Ä–∏ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã", "–°–¥–µ–ª–∞–π –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º"
3. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
4. –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–æ–∂–µ—Ç:
   - ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - üîÑ –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å (–≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)

**–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:**
- –°—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
- –ë–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç —Å–µ–±—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

#### 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π

**–°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤:**
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `terminology`
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è LLM: "–í–º–µ—Å—Ç–æ '–Ω–∞–≤–æ–∑' –∏—Å–ø–æ–ª—å–∑—É–π '—É–¥–æ–±—Ä–µ–Ω–∏—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è'"

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞:**
1. –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ—Ä–º–∏–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–Ω–∞–≤–æ–∑")
2. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "—É–¥–æ–±—Ä–µ–Ω–∏—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è")
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –°–ª–æ–≤–∞—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç LLM
- LLM —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

#### 6. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ù–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- **–í–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –æ—á–µ—Ä–µ–¥–∏

---

## –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

#### 1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (`base_prompt.py`)

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
- –†–æ–ª—å: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–≥—Ä–æ–Ω–æ–º-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
- Scope: —Ç–æ–ª—å–∫–æ —è–≥–æ–¥–Ω—ã–µ –∫—É–ª—å—Ç—É—Ä—ã
- –§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –æ—Ç–∫–∞–∑ –æ—Ç off-topic –≤–æ–ø—Ä–æ—Å–æ–≤

#### 2. –ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (`category_prompts/`)

–ö–∞–∂–¥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç:

**nutrition.py** (–ü–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π):
```python
def get_nutrition_category_prompt(culture, location, growing_type):
    """
    –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
    - –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–µ—Ñ–∏—Ü–∏—Ç–∞ –ø–∏—Ç–∞–Ω–∏—è
    - –ü–æ–¥–±–æ—Ä —É–¥–æ–±—Ä–µ–Ω–∏–π
    - –°—Ä–æ–∫–∏ –∏ –¥–æ–∑–∏—Ä–æ–≤–∫–∏ –≤–Ω–µ—Å–µ–Ω–∏—è
    - –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Å—Ö–µ–º—ã –ø–æ–¥–∫–æ—Ä–º–æ–∫
    """
```

**diseases_pests.py** (–ó–∞—â–∏—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π):
```python
def get_diseases_pests_category_prompt(culture, location, growing_type):
    """
    - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–æ–ª–µ–∑–Ω–µ–π –∏ –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π
    - –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏ —Ö–∏–º–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã
    - –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞
    - –°—Ä–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç–æ–∫
    """
```

**planting_care.py** (–ü–æ—Å–∞–¥–∫–∞ –∏ —É—Ö–æ–¥):
```python
def get_planting_care_category_prompt(culture, location, growing_type):
    """
    - –°—Ä–æ–∫–∏ –ø–æ—Å–∞–¥–∫–∏
    - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø–æ—Å–∞–¥–∫–∏
    - –û–±—Ä–µ–∑–∫–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∫–∞
    - –ú—É–ª—å—á–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–ª–∏–≤
    """
```

**soil_improvement.py** (–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ—á–≤—ã):
```python
def get_soil_improvement_category_prompt(culture, location, growing_type):
    """
    - pH –∏ –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—á–≤—ã
    - –û—Ä–≥–∞–Ω–∏–∫–∞
    - –î—Ä–µ–Ω–∞–∂
    """
```

**variety_selection.py** (–ü–æ–¥–±–æ—Ä —Å–æ—Ä—Ç–∞):
```python
def get_variety_selection_category_prompt(culture, location, growing_type):
    """
    - –ü–æ–¥–±–æ—Ä —Å–æ—Ä—Ç–æ–≤ –ø–æ –∫–ª–∏–º–∞—Ç—É
    - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–æ—Ä—Ç–æ–≤
    - –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∫—É–ª—å—Ç—É—Ä
    - –û–ø—ã–ª–µ–Ω–∏–µ
    """
```

#### 3. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ (`consultation_prompts.py`)

–°–æ–±–∏—Ä–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑:
1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
2. –ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–µ—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
3. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ RAG (—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º)
4. –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏

```python
async def build_consultation_system_prompt(
    culture: str,
    kb_snippets: List[Dict],
    consultation_category: str = "",
    default_location: str = "—Å—Ä–µ–¥–Ω—è—è –ø–æ–ª–æ—Å–∞",
    default_growing_type: str = "–æ—Ç–∫—Ä—ã—Ç—ã–π –≥—Ä—É–Ω—Ç"
) -> str:
    base = get_base_system_prompt(location, growing_type)
    category_specific = _get_category_specific_prompt(category, culture, ...)
    rag_context = build_kb_context_snippet(kb_snippets)
    terminology = await build_terminology_section()

    return "\n\n".join([base, category_specific, rag_context, terminology])
```

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä

**LLM-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä** (`classification_llm.py`):

```python
async def detect_culture_name(text: str) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫—É–ª—å—Ç—É—Ä—É –∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
    - "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è" / "–∫–ª—É–±–Ω–∏–∫–∞ –ª–µ—Ç–Ω—è—è" / "–∫–ª—É–±–Ω–∏–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
    - "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è" / "–º–∞–ª–∏–Ω–∞ –ª–µ—Ç–Ω—è—è" / "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
    - "—Å–º–æ—Ä–æ–¥–∏–Ω–∞"
    - "–≥–æ–ª—É–±–∏–∫–∞"
    - "–∂–∏–º–æ–ª–æ—Å—Ç—å"
    - "–∫—Ä—ã–∂–æ–≤–Ω–∏–∫"
    - "–µ–∂–µ–≤–∏–∫–∞"
    - "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"
    - "–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
    """
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π LLM-–≤—ã–∑–æ–≤ —Å temperature=0 (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º)
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã: "–∑–µ–º–ª—è–Ω–∏–∫–∞ —Å–∞–¥–æ–≤–∞—è" ‚Üí "–∫–ª—É–±–Ω–∏–∫–∞"
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç: "—Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è –º–∞–ª–∏–Ω–∞", "–∏—é–Ω—å—Å–∫–∞—è –∫–ª—É–±–Ω–∏–∫–∞"

---

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

```
/start (–¥–ª—è –∞–¥–º–∏–Ω–∞)
  ‚îú‚îÄ üë§ –†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ‚îî‚îÄ üõ† –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
       ‚îú‚îÄ üßæ –û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏
       ‚îÇ    ‚îú‚îÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (N –≤–æ–ø—Ä–æ—Å–æ–≤, –¥–∞—Ç–∞)
       ‚îÇ    ‚îî‚îÄ ‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å
       ‚îÇ         ‚îî‚îÄ –ö–∞–Ω–¥–∏–¥–∞—Ç #123
       ‚îÇ              ‚îú‚îÄ ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ KB
       ‚îÇ              ‚îú‚îÄ ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç
       ‚îÇ              ‚îú‚îÄ üè∑ –ö–∞—Ç–µ–≥–æ—Ä–∏—è
       ‚îÇ              ‚îî‚îÄ ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
       ‚îú‚îÄ üìö –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤
       ‚îÇ    ‚îú‚îÄ üìã –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ—Ä–º–∏–Ω—ã
       ‚îÇ    ‚îî‚îÄ ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω
       ‚îî‚îÄ ‚¨ÖÔ∏è –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é
```

### –ö–æ–º–∞–Ω–¥—ã

- `/start` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Ä–∞–∑–Ω–æ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–¥–º–∏–Ω–∞)
- `/admin` –∏–ª–∏ `/–∞–¥–º–∏–Ω` ‚Äî –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `/kb_pending` ‚Äî –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ—á–µ—Ä–µ–¥–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

### –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
ADMIN_IDS="123456789,987654321"
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```python
from src.handlers.admin import ADMIN_IDS

def is_admin(user_id: int) -> bool:
    return user_id in ADMIN_IDS
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏

1. **gpt-4.1-mini** (default) ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
   - Temperature: 0.4 (–±–∞–ª–∞–Ω—Å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å/–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
   - Max tokens: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **text-embedding-3-small** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
   - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 1536
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è RAG –ø–æ–∏—Å–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ LLM-—Å–µ—Ä–≤–∏—Å–æ–≤

```
src/services/llm/
‚îú‚îÄ‚îÄ core_llm.py                 # –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π OpenAI client
‚îÇ   ‚îî‚îÄ‚îÄ create_chat_completion(messages, model, temperature)
‚îÇ
‚îú‚îÄ‚îÄ embeddings_llm.py           # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ get_text_embedding(text) -> List[float]
‚îÇ
‚îú‚îÄ‚îÄ classification_llm.py       # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä
‚îÇ   ‚îî‚îÄ‚îÄ detect_culture_name(text) -> str
‚îÇ
‚îú‚îÄ‚îÄ consultation_llm.py         # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ ask_consultation_llm(...)
‚îÇ       ‚îú‚îÄ‚îÄ 1. get_last_messages (–∏—Å—Ç–æ—Ä–∏—è)
‚îÇ       ‚îú‚îÄ‚îÄ 2. get_text_embedding (—ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞)
‚îÇ       ‚îú‚îÄ‚îÄ 3. retrieve_unified_snippets (RAG)
‚îÇ       ‚îú‚îÄ‚îÄ 4. build_consultation_system_prompt (–ø—Ä–æ–º–ø—Ç)
‚îÇ       ‚îî‚îÄ‚îÄ 5. create_chat_completion (–æ—Ç–≤–µ—Ç)
‚îÇ
‚îî‚îÄ‚îÄ question_builder_llm.py     # DEPRECATED (—Ä–∞–Ω—å—à–µ –¥–ª—è —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

```python
answer_text = await ask_consultation_llm(
    user_id=user_id,
    telegram_user_id=telegram_user_id,
    text="–ö–∞–∫ –ø–æ–¥–∫–æ—Ä–º–∏—Ç—å –º–∞–ª–∏–Ω—É —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω—É—é –≤ –∏—é–ª–µ?",
    session_id=session_id,
    consultation_category="–ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π",
    culture="–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è",
    default_location="—Å—Ä–µ–¥–Ω—è—è –ø–æ–ª–æ—Å–∞",
    default_growing_type="–æ—Ç–∫—Ä—ã—Ç—ã–π –≥—Ä—É–Ω—Ç",
)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 6 —Å–æ–æ–±—â–µ–Ω–∏–π
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–∞
3. RAG-–ø–æ–∏—Å–∫ –ø–æ 3 —É—Ä–æ–≤–Ω—è–º:
   - Q&A –ø–∞—Ä—ã (–£–†–û–í–ï–ù–¨ 1)
   - –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è" (–£–†–û–í–ï–ù–¨ 2)
   - –û–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è" (–£–†–û–í–ï–ù–¨ 3)
4. –°–±–æ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:
   - –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (—Ä–æ–ª—å –∞–≥—Ä–æ–Ω–æ–º–∞)
   - –ü—Ä–æ–º–ø—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π"
   - RAG-–∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
   - –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏
5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –≤ messages
6. –í—ã–∑–æ–≤ GPT-4.1-mini —Å temperature=0.4
7. –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞

---

## –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üî –±–æ—Ç) –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `messages`:

```python
await log_message(
    user_id=user_id,
    direction="user",  # –∏–ª–∏ "bot"
    text=message_text,
    session_id=session_id,
    topic_id=topic_id,
)
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ LLM
- –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –î–µ–±–∞–≥ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ RAG

–í—Å–µ RAG-–æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ stdout:

```
============================================================
[RAG] –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
[RAG] –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π
[RAG] –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–∫—É–ª—å—Ç—É—Ä–∞): –º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è
[RAG] –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ö–∞–∫ –ø–æ–¥–∫–æ—Ä–º–∏—Ç—å –º–∞–ª–∏–Ω—É –≤ –∏—é–ª–µ?...
[RAG] –ü–æ–ª—É—á–µ–Ω —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞ (—Ä–∞–∑–º–µ—Ä: 1536)

[–£–†–û–í–ï–ù–¨ 1] –ü–æ–∏—Å–∫ Q&A –ø–∞—Ä...
[–£–†–û–í–ï–ù–¨ 1] –ù–∞–π–¥–µ–Ω–æ Q&A: 2

[–£–†–û–í–ï–ù–¨ 2] –ü–æ–∏—Å–∫ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...
[–£–†–û–í–ï–ù–¨ 2] –ù–∞–π–¥–µ–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: 3

[–£–†–û–í–ï–ù–¨ 3] –ü–æ–∏—Å–∫ –æ–±—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...
[–£–†–û–í–ï–ù–¨ 3] –ù–∞–π–¥–µ–Ω–æ –æ–±—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: 2

[RAG] –ù–∞–π–¥–µ–Ω–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤: 7
[RAG] –î–µ—Ç–∞–ª–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤:
  #1 [–£–†–û–í–ï–ù–¨ 1] [qa]
      –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π / –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è
      Distance: 0.2341
      –ö–æ–Ω—Ç–µ–Ω—Ç: –î–ª—è –ø–æ–¥–∫–æ—Ä–º–∫–∏ –º–∞–ª–∏–Ω—ã —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–æ–π –≤ –∏—é–ª–µ...
============================================================
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

–ü–æ–ª–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```python
[KB_CONTEXT] –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ 7 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
[KB_CONTEXT][–£–†–û–í–ï–ù–¨ 1][#1] –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: 542 —Å–∏–º–≤–æ–ª–æ–≤
[KB_CONTEXT][–£–†–û–í–ï–ù–¨ 1][#1] –ü–û–õ–ù–´–ô –¢–ï–ö–°–¢:
–î–ª—è –ø–æ–¥–∫–æ—Ä–º–∫–∏ –º–∞–ª–∏–Ω—ã —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–æ–π –≤ –∏—é–ª–µ...
------------------------------------------------------------
```

---

## Deployment –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Sadovniki_bot1.2/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/           # Aiogram handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py     # Router registration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu.py         # /start, –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultation/   # –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entry.py    # –û–±—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π handler
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pitanie_rastenii.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ posadka_uhod.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ zashita_rastenii.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ uluchshenie_pochvi.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ podbor_sorta.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/          # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ moderation.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ terminology.py
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm/            # LLM services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag/            # RAG retrieval
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/             # Repositories
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ documents/      # Document processing
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main/           # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultation/   # –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/          # –ê–¥–º–∏–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ prompts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_prompt.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultation_prompts.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ category_prompts/
‚îÇ   ‚îú‚îÄ‚îÄ models/             # Pydantic models
‚îÇ   ‚îú‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config.py           # Settings
‚îÇ   ‚îú‚îÄ‚îÄ bot.py              # Bot factory
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # Entry point
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql          # –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ schema_documents.sql
‚îÇ   ‚îú‚îÄ‚îÄ schema_topics.sql
‚îÇ   ‚îî‚îÄ‚îÄ schema_terminology.sql
‚îú‚îÄ‚îÄ docker-compose.yml      # PostgreSQL + pgvector
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ù–ï –≤ git)
‚îú‚îÄ‚îÄ CLAUDE.md               # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude Code
‚îî‚îÄ‚îÄ README.md
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)

```bash
# Telegram
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz

# PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=garden_bot
DB_USER=bot_user
DB_PASSWORD=secure_password

# OpenAI
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4.1-mini
OPENAI_EMBEDDINGS_MODEL=text-embedding-3-small

# Admin
ADMIN_IDS=123456789,987654321
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

#### 2. –ó–∞–ø—É—Å–∫ PostgreSQL

```bash
docker-compose up -d
```

#### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î

```bash
psql -h localhost -U bot_user -d garden_bot -f db/schema.sql
psql -h localhost -U bot_user -d garden_bot -f db/schema_topics.sql
psql -h localhost -U bot_user -d garden_bot -f db/schema_terminology.sql
psql -h localhost -U bot_user -d garden_bot -f db/schema_documents.sql
```

#### 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python -m src.main
```

**–í—ã–≤–æ–¥:**
```
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é –ø—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î...
–ü—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.
–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞...
–ö–æ–º–∞–Ω–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.
–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –ù–∞–∂–º–∏—Ç–µ Ctrl+C, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ.
```

### Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
version: '3.8'

services:
  db:
    image: ankane/pgvector:latest
    environment:
      POSTGRES_DB: garden_bot
      POSTGRES_USER: bot_user
      POSTGRES_PASSWORD: secure_password
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
```

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

### 1. –°—Ü–µ–Ω–∞—Ä–∏–π "–ü–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π" (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

**–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ–±—â–∞—è –∫—É–ª—å—Ç—É—Ä–∞ ‚Üí —É—Ç–æ—á–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞
- –ó–∞–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —Ç–∏–ø –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –ø–æ–¥–∫–æ—Ä–º–æ–∫

**Flow:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫ –ø–æ–¥–∫–æ—Ä–º–∏—Ç—å –º–∞–ª–∏–Ω—É?"
   ‚Üì
2. LLM –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç: "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"
   ‚Üì
3. –ë–æ—Ç: "–ö–∞–∫–∞—è —É –≤–∞—Å –º–∞–ª–∏–Ω–∞: –ª–µ—Ç–Ω—è—è –∏–ª–∏ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è?"
   ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–†–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
   ‚Üì
5. LLM –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç: "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
   ‚Üì
6. RAG-–ø–æ–∏—Å–∫ –ø–æ 3 —É—Ä–æ–≤–Ω—è–º:
   - Q&A –ø–∞—Ä—ã –¥–ª—è "–ø–∏—Ç–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π / –º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
   - –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"
   - –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"
   ‚Üì
7. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏:
   [üîÑ –ó–∞–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã] [üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω] [‚ùì –ù–æ–≤–∞—è —Ç–µ–º–∞]
```

**–ö–æ–¥:** `src/handlers/consultation/pitanie_rastenii.py`

### 2. –°—Ü–µ–Ω–∞—Ä–∏–∏ "–ü–æ—Å–∞–¥–∫–∞ –∏ —É—Ö–æ–¥", "–ó–∞—â–∏—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π", "–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ—á–≤—ã", "–ü–æ–¥–±–æ—Ä —Å–æ—Ä—Ç–∞"

**–û–±—â–∏–π –ø–æ–¥—Ö–æ–¥:**
- –û–¥–Ω–æ—ç—Ç–∞–ø–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä—ã
- RAG-–ø–æ–∏—Å–∫ —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π
- –ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

**Flow:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é
   ‚Üì
2. –í–≤–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å
   ‚Üì
3. LLM –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫—É–ª—å—Ç—É—Ä—É
   ‚Üì
4. RAG-–ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –∫—É–ª—å—Ç—É—Ä–µ
   ‚Üì
5. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
   ‚Üì
6. Q&A –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ moderation_queue
```

**–ö–æ–¥—ã:**
- `src/handlers/consultation/posadka_uhod.py`
- `src/handlers/consultation/zashita_rastenii.py`
- `src/handlers/consultation/uluchshenie_pochvi.py`
- `src/handlers/consultation/podbor_sorta.py`

### 3. –û–±—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –õ–æ–≤–∏—Ç –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –±–µ–∑ —è–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π)
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä—ã
- RAG-–ø–æ–∏—Å–∫ (–µ—Å–ª–∏ –∫—É–ª—å—Ç—É—Ä–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞)
- Legacy-—Ä–µ–∂–∏–º (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–æ–π)

**–ö–æ–¥:** `src/handlers/consultation/entry.py`

---

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å RAG

**–õ–∏–º–∏—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- Q&A (–£–†–û–í–ï–ù–¨ 1): 20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–£–†–û–í–ï–ù–¨ 2): 20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–£–†–û–í–ï–ù–¨ 3): 20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–ò—Ç–æ–≥–æ:** –¥–æ 60 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

**Distance thresholds:**
- Q&A: 0.6 (cosine similarity)
- –î–æ–∫—É–º–µ–Ω—Ç—ã: 0.75

**HNSW –∏–Ω–¥–µ–∫—Å:**
- m=16 (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–µ–π)
- ef_construction=64 (—Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è)

### –†–∞–∑–º–µ—Ä—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

- –ú–æ–¥–µ–ª—å: `text-embedding-3-small`
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 1536
- –ú–µ—Ç—Ä–∏–∫–∞: cosine similarity

### –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞

- –ü–æ—Å–ª–µ–¥–Ω–∏–µ **6 —Å–æ–æ–±—â–µ–Ω–∏–π** (3 –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ LLM

---

## –ò—Ç–æ–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **Backend:**
- –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –Ω–∞ Aiogram 3.x
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (asyncio, asyncpg)
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- PostgreSQL 16 + pgvector
- 8 —Ç–∞–±–ª–∏—Ü —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π
- HNSW –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

‚úÖ **RAG-—Å–∏—Å—Ç–µ–º–∞:**
- –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- Q&A –ø–∞—Ä—ã + –¥–æ–∫—É–º–µ–Ω—Ç—ã (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ + –æ–±—â–∏–µ)
- Fallback-–ª–æ–≥–∏–∫–∞

‚úÖ **LLM-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- OpenAI GPT-4.1-mini –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- text-embedding-3-small –¥–ª—è –≤–µ–∫—Ç–æ—Ä–æ–≤
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ (–±–∞–∑–æ–≤—ã–π + –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä

‚úÖ **–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:**
- 6 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—É–ª—å—Ç—É—Ä—ã –∏–∑ 9 —Ç–∏–ø–æ–≤
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ø–∏—Ç–∞–Ω–∏—è —Ä–∞—Å—Ç–µ–Ω–∏–π
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–∑–∞–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)

‚úÖ **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å:**
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ LLM
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥ / –≤—ã–±–æ—Ä –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—ë–º —Ç–µ—Ä–º–∏–Ω–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–æ—Å—Ç—É:**
- –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã HNSW –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- Connection pool –¥–ª—è –ë–î

**–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (Redis)
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (Celery)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏ (Prometheus + Grafana)
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã try-except:
- LLM-–≤—ã–∑–æ–≤—ã ‚Üí fallback-—Å–æ–æ–±—â–µ–Ω–∏—è
- RAG-–ø–æ–∏—Å–∫ ‚Üí –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –ë–î-–æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + graceful degradation

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –¢–æ–∫–µ–Ω—ã –≤ `.env` (–Ω–µ –≤ git)
- SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏: –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ asyncpg (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- XSS: HTML-—ç—Å–∫–µ–π–ø–∏–Ω–≥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (`html.escape`)
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ environment variable

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Connection pool:** –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
- **HNSW –∏–Ω–¥–µ–∫—Å—ã:** O(log N) –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ O(N)
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
  - history: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è)
  - RAG: —Ç–æ–ø-20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å (–Ω–µ –≤—Å–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç **Sadovniki-bot v1.2** ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è:

1. **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ AI-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏** (GPT-4, embeddings, RAG)
2. **–ù–∞–¥—ë–∂–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** (PostgreSQL + pgvector, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å)
3. **–£–¥–æ–±–Ω—ã–π UX** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
4. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** (–º–æ–¥–µ—Ä–∞—Ü–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è)

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Ä–æ—Å—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

**–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**
- GitHub Issues: https://github.com/anthropics/claude-code/issues
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: CLAUDE.md

**–í–µ—Ä—Å–∏—è:** 1.2
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-12-03
