"""
Простой скрипт для ручной проверки detect_culture_name.

Как запускать (из корня проекта, внутри venv):

    python -m src.services.llm.check_classification

Скрипт:
    - инициализирует пул подключений к БД (init_db_pool),
    - проходит по списку тестовых вопросов,
    - для каждого вызывает detect_culture_name,
    - печатает в консоль: вопрос + определённую культуру.
"""

import asyncio

# Инициализация пула подключений к БД
from src.services.db.pool import init_db_pool

# Импортируем нашу функцию классификации из соседнего модуля
from .classification_llm import detect_culture_name


# Набор тестовых вопросов, которые часто могут встречаться от пользователей
TEST_QUESTIONS = [
    # Клубника / земляника
    "Как правильно подкармливать клубнику весной для хорошего урожая?",
    "Земляника на грядке желтеет, чем её лучше подкормить?",
    "Ремонтантная клубника плохо плодоносит, какие удобрения лучше внести?",

    # Малина
    "Чем удобрять малину после обрезки осенью?",
    "Малиновые побеги слабые, не знаю, какое питание им нужно.",

    # Смородина
    "Чёрная смородина плохо завязывает ягоды, какое питание нужно кусту?",
    "Красная смородина растёт на песчаной почве, как её подкармливать?",

    # Голубика
    "Как кормить голубику на кислой почве, чтобы ягоды были крупнее?",
    "Голубика в горшке, какие удобрения подойдут для неё лучше всего?",

    # Жимолость
    "Жимолость съедобная сбрасывает завязь, чего ей может не хватать?",
    "Какое питание нужно жимолости ранней весной?",

    # Ежевика
    "Чем подкармливать ежевику для наращивания мощных побегов?",
    "Ежевика растёт в полутени, нужно ли ей дополнительное питание?",

    # Черноплодная рябина / арония
    "Черноплодная рябина плохо окрашивается, как её правильно удобрять?",
    "Аронию посадили недавно, чем её можно подкормить в первый год?",

    # Смешанные / сложные случаи
    "Хочу понять, как по-разному кормить малину и клубнику на одном участке.",
    "У меня на даче есть смородина, малина и голубика, какие общие удобрения можно использовать?",
    "Не помню сорт, но это какой-то ягодный кустарник, подскажите базовое питание.",
]


async def main() -> None:
    """
    Асинхронная точка входа:
    - инициализируем пул подключений к БД,
    - пробегаемся по всем тестовым вопросам,
    - для каждого вызываем detect_culture_name,
    - печатаем результат в читаемом виде.
    """
    # ВАЖНО: без этого kb_get_distinct_categories внутри detect_culture_name
    # упадёт с ошибкой "Пул подключений к БД не инициализирован".
    await init_db_pool()

    for idx, question in enumerate(TEST_QUESTIONS, start=1):
        culture = await detect_culture_name(question)

        print("=" * 80)
        print(f"[{idx}] ВОПРОС:")
        print(question)
        print()
        print(f"[{idx}] ОПРЕДЕЛЁННАЯ КУЛЬТУРА: {culture!r}")
        print()  # Пустая строка для удобства чтения


if __name__ == "__main__":
    asyncio.run(main())
