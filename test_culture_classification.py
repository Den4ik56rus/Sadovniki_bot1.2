#!/usr/bin/env python3
# test_culture_classification.py

"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫—É–ª—å—Ç—É—Ä—ã.

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é detect_culture_name –Ω–∞ –Ω–∞–±–æ—Ä–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—Ä–∞–∑
–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.
"""

import asyncio
import sys
from typing import List, Tuple

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–æ–≤
sys.path.insert(0, "/Users/denis/Desktop/Main/Sadovniki-bot/Sadovniki_bot1.2")

from src.services.llm.classification_llm import detect_culture_name
from src.services.db.pool import init_db_pool, close_db_pool


# –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã: (—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞, –æ–∂–∏–¥–∞–µ–º–∞—è –∫—É–ª—å—Ç—É—Ä–∞)
TEST_CASES: List[Tuple[str, str]] = [
    # === –ö–õ–£–ë–ù–ò–ö–ê –†–ï–ú–û–ù–¢–ê–ù–¢–ù–ê–Ø ===
    ("–ö–æ–≥–¥–∞ –ø–æ–¥–∫–∞—Ä–º–ª–∏–≤–∞—Ç—å –∫–ª—É–±–Ω–∏–∫—É —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω—É—é?", "–∫–ª—É–±–Ω–∏–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),
    ("–£ –º–µ–Ω—è –ù–°–î –∫–ª—É–±–Ω–∏–∫–∞ –∂–µ–ª—Ç–µ—é—Ç –ª–∏—Å—Ç—å—è", "–∫–ª—É–±–Ω–∏–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),
    ("–ó–µ–º–ª—è–Ω–∏–∫–∞ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –¥–Ω—è –Ω–µ –ø–ª–æ–¥–æ–Ω–æ—Å–∏—Ç", "–∫–ª—É–±–Ω–∏–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),
    ("–ß–µ–º —É–¥–æ–±—Ä—è—Ç—å —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω—É—é –∑–µ–º–ª—è–Ω–∏–∫—É?", "–∫–ª—É–±–Ω–∏–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),

    # === –ö–õ–£–ë–ù–ò–ö–ê –õ–ï–¢–ù–Ø–Ø ===
    ("–ö–æ–≥–¥–∞ —Å–∞–∂–∞—Ç—å –æ–±—ã—á–Ω—É—é –∫–ª—É–±–Ω–∏–∫—É?", "–∫–ª—É–±–Ω–∏–∫–∞ –ª–µ—Ç–Ω—è—è"),
    ("–£ –∏—é–Ω—å—Å–∫–æ–π –∫–ª—É–±–Ω–∏–∫–∏ –º—É—á–Ω–∏—Å—Ç–∞—è —Ä–æ—Å–∞", "–∫–ª—É–±–Ω–∏–∫–∞ –ª–µ—Ç–Ω—è—è"),
    ("–õ–µ—Ç–Ω—è—è –∑–µ–º–ª—è–Ω–∏–∫–∞ –¥–∞–µ—Ç –º–∞–ª–æ —è–≥–æ–¥", "–∫–ª—É–±–Ω–∏–∫–∞ –ª–µ—Ç–Ω—è—è"),
    ("–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –∫–ª—É–±–Ω–∏–∫–∞ —Å–æ—Ö–Ω–µ—Ç", "–∫–ª—É–±–Ω–∏–∫–∞ –ª–µ—Ç–Ω—è—è"),

    # === –ö–õ–£–ë–ù–ò–ö–ê –û–ë–©–ê–Ø (–±–µ–∑ —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ç–∏–ø–∞) ===
    ("–ö–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ –∫–ª—É–±–Ω–∏–∫–æ–π?", "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"),
    ("–ß–µ–º –ø–æ–¥–∫–æ—Ä–º–∏—Ç—å –∑–µ–º–ª—è–Ω–∏–∫—É —Å–∞–¥–æ–≤—É—é?", "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"),
    ("–ö–ª—É–±–Ω–∏–∫–∞ –ø–ª–æ—Ö–æ —Ä–∞—Å—Ç–µ—Ç", "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"),

    # === –ú–ê–õ–ò–ù–ê –†–ï–ú–û–ù–¢–ê–ù–¢–ù–ê–Ø ===
    ("–û–±—Ä–µ–∑–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–æ–π –º–∞–ª–∏–Ω—ã –æ—Å–µ–Ω—å—é", "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),
    ("–£ –º–∞–ª–∏–Ω—ã –ù–°–î —Å–∫—Ä—É—á–∏–≤–∞—é—Ç—Å—è –ª–∏—Å—Ç—å—è", "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),
    ("–ö–æ–≥–¥–∞ —Å–∞–∂–∞—Ç—å —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω—É—é –º–∞–ª–∏–Ω—É?", "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),

    # === –ú–ê–õ–ò–ù–ê –õ–ï–¢–ù–Ø–Ø ===
    ("–õ–µ—Ç–Ω—è—è –º–∞–ª–∏–Ω–∞ —Å–æ—Ö–Ω–µ—Ç", "–º–∞–ª–∏–Ω–∞ –ª–µ—Ç–Ω—è—è"),
    ("–û–±—ã—á–Ω–∞—è –º–∞–ª–∏–Ω–∞ –¥–∞–µ—Ç –º–∞–ª–æ —è–≥–æ–¥", "–º–∞–ª–∏–Ω–∞ –ª–µ—Ç–Ω—è—è"),
    ("–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –º–∞–ª–∏–Ω–∞ –±–æ–ª–µ–µ—Ç", "–º–∞–ª–∏–Ω–∞ –ª–µ—Ç–Ω—è—è"),

    # === –ú–ê–õ–ò–ù–ê –û–ë–©–ê–Ø (–±–µ–∑ —É—Ç–æ—á–Ω–µ–Ω–∏—è) ===
    ("–ö–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ –º–∞–ª–∏–Ω–æ–π?", "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"),
    ("–ú–∞–ª–∏–Ω–∞ –∂–µ–ª—Ç–µ–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å?", "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"),
    ("–ß–µ–º –ø–æ–¥–∫–æ—Ä–º–∏—Ç—å –º–∞–ª–∏–Ω—É –≤–µ—Å–Ω–æ–π?", "–º–∞–ª–∏–Ω–∞ –æ–±—â–∞—è"),

    # === –°–ú–û–†–û–î–ò–ù–ê ===
    ("–ß–µ—Ä–Ω–∞—è —Å–º–æ—Ä–æ–¥–∏–Ω–∞ —Å–æ—Ö–Ω–µ—Ç", "—Å–º–æ—Ä–æ–¥–∏–Ω–∞"),
    ("–ö—Ä–∞—Å–Ω–∞—è —Å–º–æ—Ä–æ–¥–∏–Ω–∞ –ø–ª–æ—Ö–æ —Ä–∞—Å—Ç–µ—Ç", "—Å–º–æ—Ä–æ–¥–∏–Ω–∞"),
    ("–ö–æ–≥–¥–∞ –æ–±—Ä–µ–∑–∞—Ç—å —Å–º–æ—Ä–æ–¥–∏–Ω—É?", "—Å–º–æ—Ä–æ–¥–∏–Ω–∞"),
    ("–£ —Å–º–æ—Ä–æ–¥–∏–Ω—ã –∂–µ–ª—Ç–µ—é—Ç –ª–∏—Å—Ç—å—è", "—Å–º–æ—Ä–æ–¥–∏–Ω–∞"),

    # === –ì–û–õ–£–ë–ò–ö–ê ===
    ("–ì–æ–ª—É–±–∏–∫–∞ –Ω–µ –ø–ª–æ–¥–æ–Ω–æ—Å–∏—Ç", "–≥–æ–ª—É–±–∏–∫–∞"),
    ("–ß–µ–º –ø–æ–¥–∫–∏—Å–ª–∏—Ç—å –ø–æ—á–≤—É –¥–ª—è –≥–æ–ª—É–±–∏–∫–∏?", "–≥–æ–ª—É–±–∏–∫–∞"),
    ("–£ –≥–æ–ª—É–±–∏–∫–∏ –∫—Ä–∞—Å–Ω–µ—é—Ç –ª–∏—Å—Ç—å—è", "–≥–æ–ª—É–±–∏–∫–∞"),

    # === –ñ–ò–ú–û–õ–û–°–¢–¨ ===
    ("–ñ–∏–º–æ–ª–æ—Å—Ç—å —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —è–≥–æ–¥—ã", "–∂–∏–º–æ–ª–æ—Å—Ç—å"),
    ("–ö–æ–≥–¥–∞ —Å–∞–∂–∞—Ç—å –∂–∏–º–æ–ª–æ—Å—Ç—å —Å—ä–µ–¥–æ–±–Ω—É—é?", "–∂–∏–º–æ–ª–æ—Å—Ç—å"),
    ("–£ –∂–∏–º–æ–ª–æ—Å—Ç–∏ –∂–µ–ª—Ç–µ—é—Ç –ª–∏—Å—Ç—å—è", "–∂–∏–º–æ–ª–æ—Å—Ç—å"),

    # === –ö–†–´–ñ–û–í–ù–ò–ö ===
    ("–ö—Ä—ã–∂–æ–≤–Ω–∏–∫ –Ω–µ —Ä–∞—Å—Ç–µ—Ç", "–∫—Ä—ã–∂–æ–≤–Ω–∏–∫"),
    ("–£ –∫—Ä—ã–∂–æ–≤–Ω–∏–∫–∞ –º—É—á–Ω–∏—Å—Ç–∞—è —Ä–æ—Å–∞", "–∫—Ä—ã–∂–æ–≤–Ω–∏–∫"),
    ("–ö–æ–≥–¥–∞ –æ–±—Ä–µ–∑–∞—Ç—å –∫—Ä—ã–∂–æ–≤–Ω–∏–∫?", "–∫—Ä—ã–∂–æ–≤–Ω–∏–∫"),

    # === –ï–ñ–ï–í–ò–ö–ê ===
    ("–ï–∂–µ–≤–∏–∫–∞ –Ω–µ –ø–ª–æ–¥–æ–Ω–æ—Å–∏—Ç", "–µ–∂–µ–≤–∏–∫–∞"),
    ("–ö–∞–∫ —É–∫—Ä—ã—Ç—å –µ–∂–µ–≤–∏–∫—É –Ω–∞ –∑–∏–º—É?", "–µ–∂–µ–≤–∏–∫–∞"),
    ("–£ –µ–∂–µ–≤–∏–∫–∏ —Å–æ—Ö–Ω—É—Ç –ª–∏—Å—Ç—å—è", "–µ–∂–µ–≤–∏–∫–∞"),

    # === –û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É–ª—å—Ç—É—Ä) ===
    ("–ß–µ–º –ø–æ–¥–∫–æ—Ä–º–∏—Ç—å —è–≥–æ–¥–Ω—ã–µ –∫—É—Å—Ç–∞—Ä–Ω–∏–∫–∏?", "–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"),
    ("–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —è–≥–æ–¥—ã –æ—Ç –ø—Ç–∏—Ü?", "–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"),
    ("–ö–æ–≥–¥–∞ —Å–∞–∂–∞—Ç—å —è–≥–æ–¥–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è?", "–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"),
    ("–£ –º–µ–Ω—è –º–∞–ª–∏–Ω–∞, –∫–ª—É–±–Ω–∏–∫–∞ –∏ —Å–º–æ—Ä–æ–¥–∏–Ω–∞ - —á–µ–º –∏—Ö —É–¥–æ–±—Ä—è—Ç—å?", "–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"),

    # === –ù–ï –û–ü–†–ï–î–ï–õ–ï–ù–û (–Ω–µ –ø—Ä–æ —è–≥–æ–¥—ã) ===
    ("–ö–∞–∫ –≤—ã—Ä–∞—Å—Ç–∏—Ç—å –ø–æ–º–∏–¥–æ—Ä—ã?", "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"),
    ("–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –±–µ–Ω–∑–∏–Ω?", "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"),
    ("–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â?", "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"),

    # === –°–õ–û–ñ–ù–´–ï –ö–ï–ô–°–´ (—Ä–µ–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) ===
    ("–ú–æ–∂–Ω–æ –ª–∏ —Å–µ–π—á–∞—Å –ø–æ—Å–∞–¥–∏—Ç—å —Ä–∞—Å—Å–∞–¥—É –∫–ª—É–±–Ω–∏–∫–∏ —Ñ—Ä–∏–≥–æ?", "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"),
    ("–£ –º–µ–Ω—è –Ω–∞ —É—á–∞—Å—Ç–∫–µ —Ä–∞—Å—Ç–µ—Ç —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è –º–∞–ª–∏–Ω–∞, –Ω–æ –æ–Ω–∞ –Ω–µ –¥–∞–µ—Ç —É—Ä–æ–∂–∞–π", "–º–∞–ª–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞–Ω—Ç–Ω–∞—è"),
    ("–ü–æ—á–µ–º—É —É –∑–µ–º–ª—è–Ω–∏–∫–∏ –∫—Ä–∞—è –ª–∏—Å—Ç—å–µ–≤ –∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ?", "–∫–ª—É–±–Ω–∏–∫–∞ –æ–±—â–∞—è"),
    ("–ß–µ—Ä–Ω–∞—è —Å–º–æ—Ä–æ–¥–∏–Ω–∞ –¥–∞–µ—Ç –º–µ–ª–∫–∏–µ —è–≥–æ–¥—ã, –≤ —á–µ–º –ø—Ä–∏—á–∏–Ω–∞?", "—Å–º–æ—Ä–æ–¥–∏–Ω–∞"),
    ("–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ —Ö–æ—Ä–æ—à–∏–µ —Å–æ—Ä—Ç–∞ –≥–æ–ª—É–±–∏–∫–∏ –¥–ª—è –ü–æ–¥–º–æ—Å–∫–æ–≤—å—è", "–≥–æ–ª—É–±–∏–∫–∞"),
]


async def run_tests():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã."""

    print("="*80)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ê–í–¢–û–û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –ö–£–õ–¨–¢–£–†–´")
    print("="*80)
    print()

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É–ª –ë–î
    await init_db_pool()

    total = len(TEST_CASES)
    passed = 0
    failed = 0
    errors_list = []

    for i, (text, expected) in enumerate(TEST_CASES, 1):
        try:
            result = await detect_culture_name(text)

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            is_correct = result == expected

            if is_correct:
                status = "‚úÖ PASS"
                passed += 1
            else:
                status = "‚ùå FAIL"
                failed += 1
                errors_list.append({
                    "text": text,
                    "expected": expected,
                    "got": result,
                })

            print(f"[{i}/{total}] {status}")
            print(f"  –í–æ–ø—Ä–æ—Å: {text}")
            print(f"  –û–∂–∏–¥–∞–ª–æ—Å—å: {expected}")
            print(f"  –ü–æ–ª—É—á–µ–Ω–æ: {result}")
            print()

        except Exception as e:
            status = "üí• ERROR"
            failed += 1
            errors_list.append({
                "text": text,
                "expected": expected,
                "error": str(e),
            })
            print(f"[{i}/{total}] {status}")
            print(f"  –í–æ–ø—Ä–æ—Å: {text}")
            print(f"  –û—à–∏–±–∫–∞: {e}")
            print()

    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—É–ª –ë–î
    await close_db_pool()

    # –ò—Ç–æ–≥–∏
    print("="*80)
    print("–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("="*80)
    print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {total}")
    print(f"–£—Å–ø–µ—à–Ω–æ: {passed} ({passed*100//total}%)")
    print(f"–ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {failed} ({failed*100//total}%)")
    print()

    if errors_list:
        print("="*80)
        print("–û–®–ò–ë–ö–ò –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–ò")
        print("="*80)
        for i, error in enumerate(errors_list, 1):
            print(f"\n{i}. –í–æ–ø—Ä–æ—Å: {error['text']}")
            print(f"   –û–∂–∏–¥–∞–ª–æ—Å—å: {error['expected']}")
            if "got" in error:
                print(f"   –ü–æ–ª—É—á–µ–Ω–æ: {error['got']}")
            if "error" in error:
                print(f"   –û—à–∏–±–∫–∞: {error['error']}")
        print()

    return passed, failed


if __name__ == "__main__":
    passed, failed = asyncio.run(run_tests())

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ (0 = —É—Å–ø–µ—Ö, 1 = –µ—Å—Ç—å –æ—à–∏–±–∫–∏)
    sys.exit(0 if failed == 0 else 1)
