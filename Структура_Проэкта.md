project_root/
‚îÇ
‚îú‚îÄ docker-compose.yml                # –ó–∞–ø—É—Å–∫ PostgreSQL (+ pgvector) –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ
‚îú‚îÄ db/
‚îÇ   ‚îú‚îÄ schema.sql                    # –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î: users, topics, messages, knowledge_base, moderation_queue
‚îÇ   ‚îî‚îÄ schema_topics.sql             # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è/–º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–µ topics –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º –ø–æ–ª—è–º
‚îÇ
‚îî‚îÄ src/
    ‚îÇ
    ‚îú‚îÄ main.py                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞:
    ‚îÇ   # - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—É–ª –ë–î (init_db_pool)
    ‚îÇ   # - —Å–æ–∑–¥–∞—ë—Ç bot –∏ dispatcher (create_bot_and_dispatcher)
    ‚îÇ   # - –∑–∞–ø—É—Å–∫–∞–µ—Ç dp.start_polling(bot)
    ‚îÇ   # - –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—É–ª –ë–î (close_db_pool)
    ‚îÇ
    ‚îú‚îÄ bot.py                        # –§–∞–±—Ä–∏–∫–∞ –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞:
    ‚îÇ   # - —Å–æ–∑–¥–∞—ë—Ç Bot —Å —Ç–æ–∫–µ–Ω–æ–º –∏ parse_mode
    ‚îÇ   # - —Å–æ–∑–¥–∞—ë—Ç Dispatcher
    ‚îÇ   # - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π router (setup_routers() –∏–∑ handlers/__init__.py)
    ‚îÇ
    ‚îú‚îÄ config.py                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:
    ‚îÇ   # - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω –±–æ—Ç–∞, DSN –ë–î, –∫–ª—é—á OpenAI –∏ —Ç.–ø.)
    ‚îÇ   # - –æ–±—ä–µ–∫—Ç settings, –∫–æ—Ç–æ—Ä—ã–π –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏
    ‚îÇ
    ‚îú‚îÄ handlers/                     # –í–°–Å, —á—Ç–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ Telegram-–∞–ø–¥–µ–π—Ç—ã (—Å–æ–æ–±—â–µ–Ω–∏—è, –∫–Ω–æ–ø–∫–∏)
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ __init__.py               # setup_routers():
    ‚îÇ   ‚îÇ   # - —Å–æ–∑–¥–∞—ë—Ç –∫–æ—Ä–Ω–µ–≤–æ–π Router
    ‚îÇ   ‚îÇ   # - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –∫ –Ω–µ–º—É –≤—Å–µ –ø–æ–¥-—Ä–æ—É—Ç–µ—Ä—ã (common, menu, consultation, admin)
    ‚îÇ   ‚îÇ   # - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ bot.py ‚Üí dp.include_router(setup_routers())
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ common_handlers.py        # –û–±—â–∏–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã:
    ‚îÇ   ‚îÇ   # - /start (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ø–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é)
    ‚îÇ   ‚îÇ   # - /help
    ‚îÇ   ‚îÇ   # - fallback –Ω–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ menu_handlers.py          # –õ–æ–≥–∏–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é:
    ‚îÇ   ‚îÇ   # - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ "üßë‚Äçüåæ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"
    ‚îÇ   ‚îÇ   # - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
    ‚îÇ   ‚îÇ   # - –ø–æ–∫–∞–∑/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ consultation/             # –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ —è–≥–æ–¥–Ω—ã–º
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ __init__.py           # consultation_setup():
    ‚îÇ   ‚îÇ   ‚îÇ   # - —Å–æ–∑–¥–∞—ë—Ç Router –¥–ª—è consultation
    ‚îÇ   ‚îÇ   ‚îÇ   # - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç entry_handlers, planting_handlers, care_handlers, problems_handlers
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ entry_handlers.py     # –í—Ö–æ–¥ –≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é:
    ‚îÇ   ‚îÇ   ‚îÇ   # - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "üßë‚Äçüåæ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —è–≥–æ–¥–∞–º"
    ‚îÇ   ‚îÇ   ‚îÇ   # - –ø–æ–∫–∞–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ –∫—É–ª—å—Ç—É—Ä—ã (–∫–ª—É–±–Ω–∏–∫–∞/–º–∞–ª–∏–Ω–∞/–∫—É—Å—Ç–∞—Ä–Ω–∏–∫–∏)
    ‚îÇ   ‚îÇ   ‚îÇ   # - –ø–æ–∫–∞–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (–ø–æ—Å–∞–¥–∫–∞/—É—Ö–æ–¥/–±–æ–ª–µ–∑–Ω–∏)
    ‚îÇ   ‚îÇ   ‚îÇ   # - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ topics –∏ meta:
    ‚îÇ   ‚îÇ   ‚îÇ   #   {
    ‚îÇ   ‚îÇ   ‚îÇ   #     "mode": "consultation",
    ‚îÇ   ‚îÇ   ‚îÇ   #     "culture": "strawberry" | "raspberry" | "bush",
    ‚îÇ   ‚îÇ   ‚îÇ   #     "consultation_type": "planting" | "care" | "problems"
    ‚îÇ   ‚îÇ   ‚îÇ   #   }
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ planting_handlers.py  # –°—Ü–µ–Ω–∞—Ä–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ –ø–æ—Å–∞–¥–∫–µ:
    ‚îÇ   ‚îÇ   ‚îÇ   # - –ø—Ä–∏—ë–º "—Ä—É—Ç-–≤–æ–ø—Ä–æ—Å–∞" –ø–æ –ø–æ—Å–∞–¥–∫–µ
    ‚îÇ   ‚îÇ   ‚îÇ   # - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –±–ª–æ–∫–æ–º —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
    ‚îÇ   ‚îÇ   ‚îÇ   # - –ø—Ä–∏—ë–º –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —É—Ç–æ—á–Ω—è—é—â–∏–µ
    ‚îÇ   ‚îÇ   ‚îÇ   # - –≤—ã–∑–æ–≤ services.llm.consultation_llm.ask_consultation() —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ—Å–∞–¥–∫–∏
    ‚îÇ   ‚îÇ   ‚îÇ   # - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    ‚îÇ   ‚îÇ   ‚îÇ   # - –ø–æ–∫–∞–∑ –∫–Ω–æ–ø–æ–∫ "—É—Ç–æ—á–Ω–∏—Ç—å –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ" / "–≤–æ–ø—Ä–æ—Å –æ –¥—Ä—É–≥–æ–π –∫—É–ª—å—Ç—É—Ä–µ"
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ care_handlers.py      # –°—Ü–µ–Ω–∞—Ä–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ —É—Ö–æ–¥—É:
    ‚îÇ   ‚îÇ   ‚îÇ   # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ planting_handlers, –Ω–æ —Å —Ç–∏–ø–æ–º "care"
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îî‚îÄ problems_handlers.py  # –°—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –±–æ–ª–µ–∑–Ω—è–º/–≤—Ä–µ–¥–∏—Ç–µ–ª—è–º:
    ‚îÇ   ‚îÇ       # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º ("problems")
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ admin/                    # –ê–¥–º–∏–Ω—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–º–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π)
    ‚îÇ       ‚îÇ
    ‚îÇ       ‚îú‚îÄ __init__.py           # admin_setup():
    ‚îÇ       ‚îÇ   # - —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤
    ‚îÇ       ‚îÇ
    ‚îÇ       ‚îî‚îÄ moderation_handlers.py# –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
    ‚îÇ           # - /kb_pending ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–∑ moderation_queue
    ‚îÇ           # - –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ "–í –±–∞–∑—É" / "–û—Ç–∫–ª–æ–Ω–∏—Ç—å"
    ‚îÇ           # - –ø—Ä–∏ "–í –±–∞–∑—É" ‚Üí –∑–∞–ø—Ä–æ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –≤–≤–æ–¥ –≤—Ä—É—á–Ω—É—é)
    ‚îÇ           # - –∑–∞–ø–∏—Å—å –≤ knowledge_base —á–µ—Ä–µ–∑ services.db.kb_repo
    ‚îÇ           # - —É–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ moderation_queue
    ‚îÇ
    ‚îú‚îÄ keyboards/                    # –í–°–ï –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (Reply –∏ Inline), –±–µ–∑ –ª–æ–≥–∏–∫–∏
    ‚îÇ   ‚îÇ                            # —Ñ–∞–π–ª—ã –Ω–∞–∑—ã–≤–∞—é—Ç *_keyboards.py, —á—Ç–æ–±—ã –Ω–µ –ø—É—Ç–∞—Ç—å —Å handlers
    ‚îÇ   ‚îú‚îÄ __init__.py               # —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä, —á—Ç–æ–±—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ main/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ main_menu_keyboards.py    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_main_menu_keyboard()
    ‚îÇ   ‚îÇ   ‚îÇ   #   ("üßë‚Äçüåæ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —è–≥–æ–¥–∞–º", –¥—Ä—É–≥–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îî‚îÄ common_keyboards.py       # –û–±—â–∏–µ –∫–Ω–æ–ø–∫–∏:
    ‚îÇ   ‚îÇ       # - get_back_to_menu_keyboard()
    ‚îÇ   ‚îÇ       # - get_cancel_keyboard() –∏ —Ç.–ø.
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ consultation/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ consultation_common_keyboards.py # –û–±—â–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π:
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_culture_choice_keyboard() (–∫–ª—É–±–Ω–∏–∫–∞/–º–∞–ª–∏–Ω–∞/–∫—É—Å—Ç–∞—Ä–Ω–∏–∫–∏ + "–ù–∞–∑–∞–¥")
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_consultation_type_keyboard() (–ø–æ—Å–∞–¥–∫–∞/—É—Ö–æ–¥/–±–æ–ª–µ–∑–Ω–∏)
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ planting_keyboards.py    # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ –ø–æ—Å–∞–¥–∫–µ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ care_keyboards.py        # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ —É—Ö–æ–¥—É
    ‚îÇ   ‚îÇ   ‚îî‚îÄ problems_keyboards.py    # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ admin/
    ‚îÇ       ‚îî‚îÄ moderation_keyboards.py  # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ KB:
    ‚îÇ           # - get_moderation_keyboard() ("–í –±–∞–∑—É", "–û—Ç–∫–ª–æ–Ω–∏—Ç—å")
    ‚îÇ           # - get_category_choice_keyboard() (–≤—ã–±–æ—Ä –∫—É–ª—å—Ç—É—Ä—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    ‚îÇ
    ‚îú‚îÄ services/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –ë–î, LLM, RAG (–±–µ–∑ aiogram)
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ db/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ __init__.py          # —É–¥–æ–±–Ω—ã–µ —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç—ã:
    ‚îÇ   ‚îÇ   ‚îÇ   # - init_db_pool, close_db_pool –∏–∑ pool.py
    ‚îÇ   ‚îÇ   ‚îÇ   # - —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤: users_repo, topics_repo, ...
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ pool.py              # –†–∞–±–æ—Ç–∞ —Å –ø—É–ª–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:
    ‚îÇ   ‚îÇ   ‚îÇ   # - init_db_pool() ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø—É–ª asyncpg
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_db_pool() ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—É–ª
    ‚îÇ   ‚îÇ   ‚îÇ   # - close_db_pool() ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—É–ª
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ users_repo.py        # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π users:
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_or_create_user()
    ‚îÇ   ‚îÇ   ‚îÇ   # - update_user_fields() –∏ —Ç.–ø.
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ topics_repo.py       # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π topics:
    ‚îÇ   ‚îÇ   ‚îÇ   # - create_topic(user_id, title, meta)
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_or_create_active_topic_for_user()
    ‚îÇ   ‚îÇ   ‚îÇ   # - update_topic_meta()
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_topic_with_meta()
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ messages_repo.py     # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:
    ‚îÇ   ‚îÇ   ‚îÇ   # - add_message(topic_id, role, content)
    ‚îÇ   ‚îÇ   ‚îÇ   # - get_last_messages(topic_id, limit=6) ‚Äî –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ LLM
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ kb_repo.py           # –†–∞–±–æ—Ç–∞ —Å knowledge_base:
    ‚îÇ   ‚îÇ   ‚îÇ   # - insert_kb_item(question, answer, category, embedding)
    ‚îÇ   ‚îÇ   ‚îÇ   # - search_kb_items(embedding, category, limit) ‚Äî –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îî‚îÄ moderation_repo.py   # –†–∞–±–æ—Ç–∞ —Å moderation_queue:
    ‚îÇ   ‚îÇ       # - add_candidate(question, answer, category, meta)
    ‚îÇ   ‚îÇ       # - get_pending_candidates(limit)
    ‚îÇ   ‚îÇ       # - approve_candidate(id) / reject_candidate(id)
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ llm/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ __init__.py          # —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    ‚îÇ   ‚îÇ   ‚îÇ   # - from .consultation_llm import ask_consultation
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ core_llm.py          # –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ OpenAI:
    ‚îÇ   ‚îÇ   ‚îÇ   # - chat_completion(messages, system_prompt, **params)
    ‚îÇ   ‚îÇ   ‚îÇ   # - create_embedding(text)
    ‚îÇ   ‚îÇ   ‚îÇ   #   (–≤–Ω—É—Ç—Ä–∏ ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã OpenAI API)
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ consultation_llm.py  # –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
    ‚îÇ   ‚îÇ   ‚îÇ   # - async def ask_consultation(context: ConsultationContext, user_messages: list[str]) -> ConsultationResult
    ‚îÇ   ‚îÇ   ‚îÇ   #     1) –ø–æ–ª—É—á–∞–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞
    ‚îÇ   ‚îÇ   ‚îÇ   #     2) —á–µ—Ä–µ–∑ rag.kb_retriever –∏—â–µ–º 2‚Äì3 –ø–æ—Ö–æ–∂–∏—Ö –æ—Ç–≤–µ—Ç–∞
    ‚îÇ   ‚îÇ   ‚îÇ   #     3) —Ñ–æ—Ä–º–∏—Ä—É–µ–º system_prompt –∏–∑ prompts.consultation_prompts
    ‚îÇ   ‚îÇ   ‚îÇ   #     4) –¥–æ–±–∞–≤–ª—è–µ–º –≤ messages –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ (RAG + history)
    ‚îÇ   ‚îÇ   ‚îÇ   #     5) –≤—ã–∑—ã–≤–∞–µ–º core_llm.chat_completion(...)
    ‚îÇ   ‚îÇ   ‚îÇ   #     6) –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –¥–∞–Ω–Ω—ã–µ –¥–ª—è moderation_queue
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ classification_llm.py # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:
    ‚îÇ   ‚îÇ   ‚îÇ   # - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫—É–ª—å—Ç—É—Ä—É/—Ç–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Ç–µ–∫—Å—Ç—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–¥—Ä—É–≥–∞—è —Ç–µ–º–∞" –±–µ–∑ –≤—ã–±–æ—Ä–∞
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îî‚îÄ embeddings_llm.py    # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏:
    ‚îÇ   ‚îÇ       # - get_text_embedding(text)
    ‚îÇ   ‚îÇ       # - batch_get_embeddings(list_of_texts)
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ rag/
    ‚îÇ       ‚îú‚îÄ __init__.py          # —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç rag-—Ñ—É–Ω–∫—Ü–∏–π
    ‚îÇ       ‚îî‚îÄ kb_retriever.py      # RAG –Ω–∞–¥ knowledge_base:
    ‚îÇ           # - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç embedding + category
    ‚îÇ           # - –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ kb_repo.search_kb_items(...)
    ‚îÇ           # - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–º—Ç–∞
    ‚îÇ
    ‚îú‚îÄ prompts/
    ‚îÇ   ‚îú‚îÄ __init__.py              # —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–º—Ç–æ–≤
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ consultation_prompts.py  # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º—Ç—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π:
    ‚îÇ   ‚îÇ   # - –±–∞–∑–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç:
    ‚îÇ   ‚îÇ   #   "—Ç—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —è–≥–æ–¥–Ω—ã–º –∫—É–ª—å—Ç—É—Ä–∞–º, –æ—Ç–≤–µ—á–∞–µ—à—å —Ç–æ–ª—å–∫–æ –ø–æ —è–≥–æ–¥–∞–º"
    ‚îÇ   ‚îÇ   # - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –ø–æ—Å–∞–¥–∫–∏/—É—Ö–æ–¥–∞/–±–æ–ª–µ–∑–Ω–µ–π
    ‚îÇ   ‚îÇ   # - –∂—ë—Å—Ç–∫–∏–π –∑–∞–ø—Ä–µ—Ç:
    ‚îÇ   ‚îÇ   #   "–µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ —è–≥–æ–¥–Ω—ã–º ‚Äî –∫—Ä–∞—Ç–∫–æ —Å–æ–æ–±—â–∏, —á—Ç–æ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—à—å —Ç–æ–ª—å–∫–æ –ø–æ —è–≥–æ–¥–Ω—ã–º"
    ‚îÇ   ‚îÇ   # - —É–∫–∞–∑–∞–Ω–∏–µ:
    ‚îÇ   ‚îÇ   #   "–Ω–µ –¥–æ–±–∞–≤–ª—è–π –≤ –∫–æ–Ω—Ü–µ '–µ—Å–ª–∏ –±—É–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã...' –∏ –ø–æ–¥–æ–±–Ω—ã–µ —Ö–≤–æ—Å—Ç—ã"
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ moderation_prompts.py    # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—Ä–æ–º—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∑–∞–¥–∞—á (–µ—Å–ª–∏ LLM –ø–æ–º–æ–≥–∞–µ—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É)
    ‚îÇ
    ‚îú‚îÄ models/
    ‚îÇ   ‚îú‚îÄ __init__.py              # —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ base_models.py           # –±–∞–∑–æ–≤—ã–π BaseModel (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Pydantic), –æ–±—â–∏–µ —Ç–∏–ø—ã
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ consultation_models.py   # –ú–æ–¥–µ–ª–∏ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π:
    ‚îÇ   ‚îÇ   # - ConsultationContext:
    ‚îÇ   ‚îÇ   #     mode: Literal["consultation"]
    ‚îÇ   ‚îÇ   #     culture: Literal["strawberry", "raspberry", "bush"]
    ‚îÇ   ‚îÇ   #     consultation_type: Literal["planting", "care", "problems"]
    ‚îÇ   ‚îÇ   #     topic_id: int
    ‚îÇ   ‚îÇ   # - ConsultationResult:
    ‚îÇ   ‚îÇ   #     answer_text: str
    ‚îÇ   ‚îÇ   #     kb_candidate: Optional[KbCandidate]
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ kb_models.py             # –ú–æ–¥–µ–ª–∏ –¥–ª—è knowledge_base –∏ moderation_queue:
    ‚îÇ   ‚îÇ   # - KbItem
    ‚îÇ   ‚îÇ   # - KbCandidate
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ user_models.py           # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îÇ
    ‚îú‚îÄ utils/
    ‚îÇ   ‚îú‚îÄ logging_utils.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–æ–≤:
    ‚îÇ   ‚îÇ   # - —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
    ‚îÇ   ‚îÇ   # - —É—Ä–æ–≤–Ω–∏ (INFO/DEBUG/ERROR)
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ text_utils.py            # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞:
    ‚îÇ   ‚îÇ   # - –æ–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    ‚îÇ   ‚îÇ   # - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤
    ‚îÇ   ‚îÇ   # - –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞ –∫ —ç–º–±–µ–¥–¥–∏–Ω–≥—É
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ json_utils.py            # (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) —Ä–∞–±–æ—Ç–∞ —Å JSON/meta:
    ‚îÇ       # - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è meta –¥–ª—è topics
    ‚îÇ
    ‚îú‚îÄ middlewares/
    ‚îÇ   ‚îú‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ logging_middleware.py    # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–∏–¥–ª–≤–∞—Ä—å –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–ø–¥–µ–π—Ç–æ–≤ aiogram
    ‚îÇ   ‚îî‚îÄ db_session_middleware.py # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—Ä–æ–±—Ä–æ—Å –∫–æ–Ω–Ω–µ–∫—Ç–∞/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤
    ‚îÇ
    ‚îî‚îÄ filters/
        ‚îú‚îÄ __init__.py
        ‚îî‚îÄ consultation_filters.py  # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–≤–æ–∏ —Ñ–∏–ª—å—Ç—Ä—ã:
            # - —Ñ–∏–ª—å—Ç—Ä "—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ mode == consultation"
            # - —Ñ–∏–ª—å—Ç—Ä –ø–æ culture / consultation_type
